### 对象的访问定位

`Java`程序会通过栈上的`reference`数据来操作堆上的具体对象。

为什么是栈上，因为程序执行对于`Java`来说就是一个个方法的执行。

`reference`类型在《`Java`虚拟机规范》里只规定了它是一个指向对象的引用，

并没有定义这个引用通过什么方式去定位、访问到堆中对象的具体位置。

主流的访问方式有如下两种：

* 句柄
* 直接指针



#### 句柄

`Java`堆中将可能划分出一块内存作为句柄池，`reference`中存储的就是对象的

句柄地址，而句柄中包含了对象实例数据与类型数据各自具体的地址信息。（这种就不要在对象头中存放类型指针了）

![](img\通过句柄访问对象.png)

优点：

最大的好处就是`reference`中存储的是稳定句柄地址，在对象移动时只会改变句柄中的

实例数据指针，而`reference`本身不需要被修改。



#### 直接指针

如果使用直接指针，`Java`堆中对象的内存布局就必须考虑如何放置访问类型数据的相关信息，

`reference`中存储的直接就是对象地址，如果只是访问对象本身的话，就不需要多一次间接访问的开销。

![](img\通过直接指针访问对象.png)

优点：

速度更快，节省了一次指定定位的时间开销。`HotSpot`主要是有那个直接指针（`Shenandoah`会有一次额外的转发）